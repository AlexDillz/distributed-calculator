# Distributed Calculator

–†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π –≤ –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º —Ä–µ–∂–∏–º–µ —Å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é –≤ SQLite –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ–º –ø–æ gRPC.

---

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

1. **Orchestrator (Server)**  
   - REST API –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (`/api/v1/...`)  
   - gRPC-–∫–ª–∏–µ–Ω—Ç –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤  
   - –•—Ä–∞–Ω–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã—Ä–∞–∂–µ–Ω–∏–π –≤ SQLite  
   - –ú–∞—Ä—à—Ä—É—Ç–∏—Ç –∑–∞–ø—Ä–æ—Å—ã, —Ä–∞–∑–±–∏–≤–∞—è –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –ø–æ–¥–∑–∞–¥–∞—á–∏ (–ø–æ –æ–¥–∏–Ω RPC-–∑–∞–ø—Ä–æ—Å –Ω–∞ –∫–∞–∂–¥—É—é –æ–ø–µ—Ä–∞—Ü–∏—é)

2. **Agent**  
   - gRPC-—Å–µ—Ä–≤–µ—Ä, –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–¥–∞—á–∏ –æ—Ç Orchestrator, —Å—á–∏—Ç–∞–µ—Ç –∏—Ö –ª–æ–∫–∞–ª—å–Ω–æ (–º–æ–Ω–æ-–ø–æ—Ç–æ—á–Ω—ã–º–∏ goroutine)  
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —á–µ—Ä–µ–∑ —Ç–æ—Ç –∂–µ –ø–æ—Ç–æ–∫  
   - –ú–æ–∂–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å—Å—è –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–æ–≤—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤/–∏–Ω—Å—Ç–∞–Ω—Å–æ–≤  

**–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏**  
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ª–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (JWT)  
- –ó–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è: –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∫–æ–≥–¥–∞ —Å–µ—Ä–≤–µ—Ä –∑–∞–≤–µ—Ä—à–∏–ª –≤—Å–µ –ø–æ–¥–∑–∞–¥–∞—á–∏  
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –≤ –ë–î  
- REST-ENDPOINTS:  
  - `POST /api/v1/register`  
  - `POST /api/v1/login`  
  - `POST /api/v1/calculate`  
  - `GET  /api/v1/expressions`  
  - `GET  /api/v1/expressions/{id}`  
- –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ Orchestrator ‚Üî Agent –ø–æ gRPC  

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

+-----------+ HTTP +-----------------+ gRPC +---------+
| –ö–ª–∏–µ–Ω—Ç | <----------> | Orchestrator | <---------> | Agent |
| (curl, | REST | (REST + gRPC | Tasks | (Compute|
| Postman) | | client) | | Worker)|
+-----------+ +-----------------+ +---------+
| |
| +-------------------------------+ |
+-----> | SQLite (expressions) | <------------+
+-------------------------------+

- –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç JWT-–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π REST-–∑–∞–ø—Ä–æ—Å –Ω–∞ Orchestrator.  
- Orchestrator —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç –ø–æ–ª–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –≤ –ø–æ—Ç–æ–∫ gRPC-–∑–∞–ø—Ä–æ—Å–æ–≤ –∞–≥–µ–Ω—Ç—É.  
- –ê–≥–µ–Ω—Ç —Å—á–∏—Ç–∞–µ—Ç –≤—ã—Ä–∞–∂–µ–Ω–∏–µ (–∫–∞–∂–¥—É—é –æ–ø–µ—Ä–∞—Ü–∏—é) –∏ –ø–æ—Ç–æ–∫–æ–≤–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.  
- Orchestrator –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

---

## –ß—Ç–æ –Ω—É–∂–Ω–æ

- Go 1.23 –∏ –≤—ã—à–µ  
- Docker & Docker-Compose (–¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞)  
- `protoc` + –ø–ª–∞–≥–∏–Ω—ã `protoc-gen-go` –∏ `protoc-gen-go-grpc` (–¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ proto, –µ—Å–ª–∏ –º–µ–Ω—è–µ—Ç–µ `.proto`)  

---

## –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone https://github.com/AlexDillz/distributed-calculator.git
cd distributed-calculator

–õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –±–µ–∑ Docker
–°–±–æ—Ä–∫–∞ proto (–µ—Å–ª–∏ –º–µ–Ω—è–ª–∏ .proto):

bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
make proto
–ó–∞–ø—É—Å–∫ Orchestrator:

bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
DATABASE_PATH=./calc.db GRPC_PORT=:50051 HTTP_PORT=:8080 go run cmd/server/main.go
–ó–∞–ø—É—Å–∫ Agent (–≤ –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ):

bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
GRPC_PORT=:50051 COMPUTING_POWER=4 go run cmd/agent/main.go
COMPUTING_POWER ‚Äî —á–∏—Å–ª–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤ (–≥–æ—Ä—É—Ç–∏–Ω).

üê≥ –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker & Docker-Compose
–°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞:

bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
make build
–ü–æ–¥–Ω—è—Ç—å —Å–µ—Ä–≤–∏—Å—ã:

bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
make up
–ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é:

bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
docker-compose up --build -d
–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:

bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
make logs
–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞:

bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
make down
üîß Environment Variables
–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è	–û–ø–∏—Å–∞–Ω–∏–µ	–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
DATABASE_PATH	–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É SQLite DB	calc.db
GRPC_PORT	–ü–æ—Ä—Ç –¥–ª—è gRPC —Å–µ—Ä–≤–µ—Ä–∞ –∞–≥–µ–Ω—Ç–∞	:50051
HTTP_PORT	–ü–æ—Ä—Ç –¥–ª—è HTTP —Å–µ—Ä–≤–µ—Ä–∞ Orchestrator	:8080
COMPUTING_POWER	–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Ä—É—Ç–∏–Ω –≤ Agent	1
JWT_SECRET	–°–µ–∫—Ä–µ—Ç –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ JWT	secret_key

üì° –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ (curl)
1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
curl -i -X POST http://localhost:8080/api/v1/register \
  -H "Content-Type: application/json" \
  -d '{"login":"user1","password":"pass123"}'
–û—Ç–≤–µ—Ç:

–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
HTTP/1.1 200 OK
OK
2. –õ–æ–≥–∏–Ω
bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
curl -i -X POST http://localhost:8080/api/v1/login \
  -H "Content-Type: application/json" \
  -d '{"login":"user1","password":"pass123"}'
–û—Ç–≤–µ—Ç:

json
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
HTTP/1.1 200 OK
{
  "token": "<–≤–∞—à_JWT_—Ç–æ–∫–µ–Ω>"
}
3. –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
curl -i -X POST http://localhost:8080/api/v1/calculate \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <TOKEN>" \
  -d '{"expression":"2+2*2"}'
–û—Ç–≤–µ—Ç:

json
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
HTTP/1.1 200 OK
{"result":6}
4. –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π
bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
curl -i -X GET http://localhost:8080/api/v1/expressions \
  -H "Authorization: Bearer <TOKEN>"
–û—Ç–≤–µ—Ç:

json
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
HTTP/1.1 200 OK
{
  "expressions":[
    {"id":1,"status":"done","result":6},
    {"id":2,"status":"error","result":0}
  ]
}
5. –î–µ—Ç–∞–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
curl -i -X GET http://localhost:8080/api/v1/expressions/1 \
  -H "Authorization: Bearer <TOKEN>"
–û—Ç–≤–µ—Ç:

json
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
HTTP/1.1 200 OK
{
  "expression":{"id":1,"status":"done","result":6}
}
üì¨ –ü—Ä–∏–º–µ—Ä—ã –≤ Postman
–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–ª–ª–µ–∫—Ü–∏—é Distributed Calculator.

–î–æ–±–∞–≤—å—Ç–µ Request Register:

Method: POST

URL: {{baseUrl}}/api/v1/register

Body ‚Üí raw JSON { "login":"user1","password":"pass123" }

–î–æ–±–∞–≤—å—Ç–µ Request Login:

Method: POST

URL: {{baseUrl}}/api/v1/login

Body ‚Üí raw JSON { "login":"user1","password":"pass123" }

Tests:

js
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
pm.environment.set("jwt", pm.response.json().token);
–î–æ–±–∞–≤—å—Ç–µ Request Calculate:

Method: POST

URL: {{baseUrl}}/api/v1/calculate

Headers:

Authorization: Bearer {{jwt}}

Content-Type: application/json

Body: { "expression":"2+2*2" }

Request ListExpressions:

Method: GET

URL: {{baseUrl}}/api/v1/expressions

Header: Authorization: Bearer {{jwt}}

Request GetExpressionById:

Method: GET

URL: {{baseUrl}}/api/v1/expressions/1

Header: Authorization: Bearer {{jwt}}

–í –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (Environments) –∑–∞–¥–∞–π—Ç–µ:

text
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
baseUrl = http://localhost:8080
‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
Unit-—Ç–µ—Å—Ç—ã:

bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
go test ./pkg/calculation
go test ./internal/storage
go test ./internal/agent
go test ./internal/server
Integration-—Ç–µ—Å—Ç—ã:

bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
go test ./tests/integration